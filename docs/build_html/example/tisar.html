

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Time-interleaved SAR ADC generator &mdash; laygo_documentation 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="laygo_documentation 1.0 documentation" href="../index.html"/>
        <link rel="next" title="Example codes" href="code.html"/>
        <link rel="prev" title="CMOS SER/DES generator" href="ser_des.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> laygo_documentation</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#installation-and-quick-start">Installation and Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#documentations">Documentations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#example-labs">Example Labs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#example-generators">Example Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/introduction.html#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_GDS.html">Tutorial (GDS flow)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#initialize-gridlayoutgenerator">Initialize GridLayoutGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#load-template-and-grid-database">Load template and grid database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#library-and-cell-creation">Library and cell creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#cell-placements">Cell placements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#signal-routing">Signal routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#power-routing">Power routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#pin-creation">Pin creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_GDS.html#gds-export">GDS export</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial_BAG.html">Tutorial (BAG flow)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#setup-and-running">Setup and running</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#initialize-gridlayoutgenerator">Initialize GridLayoutGenerator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#load-template-and-grid-database">Load template and grid database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#library-and-cell-creation">Library and cell creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#cell-placements">Cell placements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#signal-routing">Signal routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#power-routing">Power routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#pin-creation">Pin creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/tutorial_BAG.html#export-to-bag">Export to BAG</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../architecture/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="logic.html">Generator example - CMOS logic family</a><ul>
<li class="toctree-l2"><a class="reference internal" href="logic.html#install-and-launch">Install and launch</a></li>
<li class="toctree-l2"><a class="reference internal" href="logic.html#supported-logic-gate-types">Supported logic gate types</a></li>
<li class="toctree-l2"><a class="reference internal" href="logic.html#schematic-templates">Schematic templates</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="serdes.html">Generator example - CMOS 2:1 mux serializer (obsolete)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="serdes.html#install-and-launch">Install and launch</a></li>
<li class="toctree-l2"><a class="reference internal" href="serdes.html#parameterizations">Parameterizations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ser_des.html">Generator example - Flexible CMOS SERDES</a><ul>
<li class="toctree-l2"><a class="reference internal" href="ser_des.html#structure">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="ser_des.html#setup-for-bwrc-users">Setup (for BWRC users)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ser_des.html#serializer-generation">Serializer Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ser_des.html#deserializer-generation">Deserializer Generation</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Generator example - TISAR ADC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-parameters">Setting up parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tisaradc-architecture">TISARADC architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subadc-frontend-layout-generation">SubADC frontend layout generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subadc-backend-layout-generation">SubADC backend layout generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subadc-switch-generation">SubADC switch generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#subadc-top-generation">SubADC top generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#array-generation">Array generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clocking-path-generation">Clocking path generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#retimer">Retimer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bias">Bias</a></li>
<li class="toctree-l2"><a class="reference internal" href="#top">Top</a></li>
<li class="toctree-l2"><a class="reference internal" href="#full-stack-generation">Full stack generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contributors">Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="code.html">Code examples (to be uploaded)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="code.html#code-example-1-low-level-building-block-generations-using-primitive-templates">Code example 1: low-level building block generations using primitive templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="code.html#code-example-2-high-level-building-block-top-generations">Code example 2: high-level building block / top generations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tech/tech.html">Technology setup instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tech/tech.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tech/tech.html#example-setup-files">Example setup files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tech/tech.html#laygo-config-yaml">laygo_config.yaml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tech/tech.html#tech-lib-layermap-optional">(tech_lib).layermap (optional)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tech/tech.html#template-library">template library</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/laygo.html">laygo package</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">laygo_documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Time-interleaved SAR ADC generator</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/example/tisar.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="time-interleaved-sar-adc-generator">
<span id="time-interleaved-sar-adc-generator"></span><h1>Time-interleaved SAR ADC generator<a class="headerlink" href="#time-interleaved-sar-adc-generator" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to generate a time-interleaved SAR ADC
schematic and layout using BAG and laygo.</p>
<div class="section" id="overview">
<span id="overview"></span><h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Time Interleaved Successive Approximation ADC (TISARADC) is a popular
way of implementing a moderate precision (4-10 bits) ADC that operates
at higher sampling rates than single SAR ADCs can achieve. As an example
of demonstrating the automated analog and mixed signal circuits
generation flow, the entire TISARADC generator is explained here.</p>
</div>
<div class="section" id="installation">
<span id="installation"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p class="first">Set up a BAG/laygo working directory for the your technology.
For example, cds_ff_mpt environment can be set up by running the
following commands.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone git@github.com:ucb-art/BAG2_cds_ff_mpt.git
$ cd BAG2_cds_ff_mpt
$ git submodule init
$ git submodule update
$ git submodule foreach git pull origin master
</pre></div>
</div>
<blockquote>
<div><p>Note: for BWRC users, comprehensive working environments are
provided under proper NDAs for certain technologies. Use the
following repos and skip step 2, 3, 5, 6.</p>
</div></blockquote>
<blockquote>
<div><ol class="simple">
<li><strong>tsmc16FFC</strong>: <code class="docutils literal"><span class="pre">git&#64;bwrcrepo.eecs.berkeley.edu:jdhan/TISARADC_TSMC16FFC.git</span></code></li>
<li><strong>tsmc28hpm</strong>:</li>
</ol>
</div></blockquote>
</li>
<li><p class="first">Copy configuration files and design libraries from
laygo/generators/adc_sar/yaml by typing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">yaml</span><span class="o">/</span><span class="n">adc_sar_spec</span><span class="o">.</span><span class="n">yaml</span> <span class="o">.</span>
<span class="n">cp</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">yaml</span><span class="o">/</span><span class="n">adc_sar_size</span><span class="o">.</span><span class="n">yaml</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">BagModules</span><span class="o">/</span><span class="n">adc_sar_templates</span> <span class="n">BagModules</span><span class="o">/</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_templates</span> <span class="o">.</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">r</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_testbenches</span> <span class="o">.</span>
</pre></div>
</div>
<blockquote>
<div><p>Note: some repos may already have those files in their working
directories.</p>
</div></blockquote>
</li>
<li><p class="first">Add library definitions to your cds.lib</p>
<p><em>In cds.lib</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DEFINE</span> <span class="n">adc_sar_templates</span> <span class="o">./</span><span class="n">adc_sar_templates</span>
<span class="n">DEFINE</span> <span class="n">adc_sar_testbenches</span> <span class="o">./</span><span class="n">adc_sar_testbenches</span>
</pre></div>
</div>
</li>
<li><p class="first">Open bag_lib.defs and remove the definition of adc_sar_templates if
exist</p>
<p><em>In bag_lib.defs</em></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">adc_sar_templates</span> <span class="n">BagModules</span> <span class="c1">#remove this</span>
</pre></div>
</div>
</li>
<li><p class="first">Run virtuoso and type the following command in CIW.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">load</span> <span class="s2">&quot;start_bag.il&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Open <strong>adc_sar_templates/capdac</strong> and update the library name of C0 and
CDAC0 to **(technology_name)_micretemplates_dense**, as shown below.</p>
<p><img alt="CDAC" src="../_images/tisaradc_capdac_template.png" /></p>
</li>
<li><p class="first">Launch bag and run the following import script.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_import</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p class="first">In the IPython interpreter, type the following command to construct
the template and grid database. (Make sure proper techlib is attached
to the microtemplate library)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">labs</span><span class="o">/</span><span class="n">lab2_a_gridlayoutgenerator_constructtemplate</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p class="first">Run the following command to generate the logic gate template
library. The library name will be (technology_name)_logic_templates.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">logic</span><span class="o">/</span><span class="n">logic_templates_layout_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="setting-up-parameters">
<span id="setting-up-parameters"></span><h2>Setting up parameters<a class="headerlink" href="#setting-up-parameters" title="Permalink to this headline">¶</a></h2>
<p>ADC schematic and layout are constructed based on spec/size parameters
defined in 2 configuration files in <strong>YAML</strong> format
(<strong>adc_sar_spec.yaml, adc_sar_size.yaml</strong>).</p>
<p>Following parameters are defined in the configuration files:</p>
<ol class="simple">
<li>adc_sar_spec.yaml<ul>
<li><strong>temp</strong>: nominal temperature</li>
<li><strong>temp_min</strong>: minimum temperature</li>
<li><strong>temp_max</strong>: maximum temperature</li>
<li><strong>v_in</strong>: nominal input swing (single ended)</li>
<li><strong>v_in_max</strong>: maximum input swing</li>
<li><strong>v_in_cm</strong>: nominal inpuut common mode</li>
<li><strong>n_bit</strong>: number of output bits</li>
<li><strong>n_bit_cal</strong>: number of output bits after digital calibration</li>
<li><strong>fsamp</strong>: effective sampling rate</li>
<li><strong>n_interleave</strong>: interleaving ratio</li>
<li><strong>c_unit</strong>: minimum unit capacitance of CDAC</li>
<li><strong>c_ground</strong>: grounded parasitic capacitance of c_unit</li>
<li><strong>c_delta</strong>: maximum capacitance mismatch of c_unit (normalized by
c_unit)</li>
<li><strong>n_bit_samp_noise</strong>: standard deviation of sampling noise (in bits)</li>
<li><strong>n_bit_samp_settle</strong>: maximum sampler settling error in bits</li>
<li><strong>n_bit_comp_noise</strong>: standard deviation of comparator noise in bits</li>
<li><strong>rdx_array</strong>: CDAC radix array</li>
<li><strong>rdx_enob</strong>: Target ENOB after calibration</li>
<li><strong>cycle_comp</strong>: Comparator timing budget in cycle</li>
<li><strong>cycle_logic</strong>: Logic timing budget in cycle</li>
<li><strong>cycle_dac</strong>: DAC timing budget in cycle</li>
<li><strong>vdd</strong>: nominal supply voltage</li>
<li><strong>vdd_min</strong>: minimum supply voltage</li>
<li><strong>vdd_max</strong>: maximum supply voltage</li>
</ul>
</li>
<li>adc_sar_size.yaml<ul>
<li><strong>capdac_c_m</strong>: multiplier of CDAC unit capacitor</li>
<li><strong>capdac_num_bits_vertical</strong>: CDAC number of bits in vertical
direction</li>
<li><strong>capdac_num_bits_horizontal</strong>: CDAC number of bits in horizontal
direction</li>
<li><strong>capdrv_m_list</strong>: cap driver multiplier list</li>
<li><strong>capdrv_space_offset</strong>: cap driver spacing parameter, for routing</li>
<li><strong>salatch_m</strong>: strongArm latch sizing</li>
<li><strong>salatch_m_buf</strong>: strongArm latch output buffer sizing</li>
<li><strong>salatch_m_rgnn</strong>: strongArm latch regenerative latch sizing</li>
<li><strong>salatch_m_rst</strong>: strongArm latch reset device sizing</li>
<li><strong>sarclkgen_m</strong>: strongArm latch clock generator sizing</li>
<li><strong>sarclkgen_fo</strong>: strongArm latch clock generator fanout</li>
<li><strong>sarclkgen_ndelay</strong>: strongArm latch clock generator # of delays</li>
<li><strong>sarret_m</strong>: strongArm latch output retimer sizing</li>
<li><strong>sarret_fo</strong>: strongArm latch output retimer fanout</li>
<li><strong>sarfsm_m</strong>: SAR FSM sizing</li>
<li><strong>sarlogic_m</strong>: SAR logic sizing</li>
<li><strong>dcap2_m</strong>:</li>
<li><strong>num_space_samp</strong>:</li>
<li><strong>num_space_sar</strong>:</li>
</ul>
</li>
</ol>
<p>For the starting point, following preset files are provided. They are
not 100% finalized, but will serve well for initializations.</p>
<ol class="simple">
<li>**adc_sar_spec(size)_craft.yaml** : 9.6GS/s, 9bit ADC with digital
calibration.</li>
<li>**adc_sar_spec(size)_11b.yaml** : GS/s, 11bit ADC with digital
calibration.</li>
<li>**adc_sar_spec(size)_6b.yaml** : 2GS/s, 6bit ADC with radix-2
constellation.</li>
</ol>
</div>
<div class="section" id="tisaradc-architecture">
<span id="tisaradc-architecture"></span><h2>TISARADC architecture<a class="headerlink" href="#tisaradc-architecture" title="Permalink to this headline">¶</a></h2>
<p>TISARADC is composed of 4 parts in the top level: ADC core, clock
generator, output retimer and biasing.</p>
<ul class="simple">
<li>The <strong>ADC core</strong> performs the actual conversion operation. It is
composed of multi-phased sampling frontend and N subADC that
converts the actual ADC operation at (sampling_rate/N), where N is
the interleaving ratio.</li>
<li>The <strong>clock generator</strong> receives the high frequency clock at sampling
rate, generates multi-phased clock for the interleaved ADC operation.</li>
<li>The <strong>output retimer</strong> receives the output from the ADC core, aligns
multi-phased signals to a single clock to be received by the
following digital backend.</li>
</ul>
</div>
<div class="section" id="subadc-frontend-layout-generation">
<span id="subadc-frontend-layout-generation"></span><h2>SubADC frontend layout generation<a class="headerlink" href="#subadc-frontend-layout-generation" title="Permalink to this headline">¶</a></h2>
<p>The frontend of subADCs is composed of three parts: capdac (CDAC),
strongArm comparator (salatch), cap driver (capdrv). In the proposed
flow, the &#8216;very&#8217; frontend sampling switches are not the part of
subADC frontend because they are designed separately, but obviously
this is not the only way of partition.</p>
<ol>
<li><p class="first">The first block to be generated is CDAC, since this generator
assumes the horizontal dimension is limited by CDAC size in x-direction.
In order to generate CDAC layout, type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_capdac_layout_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This command will create a CDAC layout in
<strong>adc_sar_generated/capdac</strong>, as shown below.</p>
<p><img alt="CDAC" src="../_images/tisaradc_capdac.png" /></p>
<ul class="simple">
<li>The capdac generator reads <strong>n_bit</strong> and <strong>rdx_array</strong> parameters
from <strong>adc_sar_spec.yaml</strong>, and <strong>capdac_c_m</strong>,
<strong>capdac_num_bits_vertical</strong>, <strong>capdac_num_bits_horizontal</strong>
parameters from <strong>adc_sar_size.yaml</strong> (or use default settings in
the python code if <strong>load_from_file</strong> is set to <strong>false</strong>), users
can update those parameters and regenerate the capdac. It will
create a new CDAC with different shapes, as shown below.</li>
</ul>
<p><img alt="CDAC" src="../_images/tisaradc_capdac2.png" /></p>
<ul>
<li><p class="first">If you want to generate the schematic as well, type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_capdac_schematic_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The figure shown below is one example of generated schematic.
Note that CDAC capacitors (I0-I7) are arrayed, with radix
parameters specified by <strong>rdx_array</strong>.</p>
</li>
</ul>
<p><img alt="CDAC" src="../_images/tisaradc_capdac_sch.png" /></p>
<ul>
<li><p class="first">The schematic generation is not required for full-ADC
generations, since you can generate the whole ADC schematic by
running a top-cell generation script (unlike the layout counterpart,
which requires running several scripts in series to generate the
entire ADC). The CDAC schematic generation is used for cell level
verifications though, such as LVS or transfer curve extraction. For
LVS, type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_capdac_lvs</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>It will give a <strong>lvs passed</strong>  message if the design is LVS
clean.</p>
<blockquote>
<div><p>Note: BAG2_cds_ff_mpt / FreePDK45 does not support LVS &amp;
extraction at this moment. Skip these steps for those processes</p>
</div></blockquote>
</li>
<li><p class="first">For parasitic extraction, type the following command.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_capdac_extract</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<blockquote>
<div><p>Note: this step could take a long time, depending on your
extraction setup. Skip this if you just want to quickly go
through steps.</p>
</div></blockquote>
</li>
<li><p class="first">You can run simulations on CDAC via BAG framework. The following
command will launch the transfer curve simulation with
schematic netlists. For the post-extract simulation, set
<strong>extracted = True</strong> in the script.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_capdac_verify</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><img alt="salatch" src="../_images/tisaradc_capsim.png" /></p>
<p>Simulation results from various settings (left: 5b-radix2,
center: 8b-sub2radix, right: 10b-sub2radix)</p>
</li>
</ul>
</li>
<li><p class="first">After CDAC generation, strongArm latch layout can be generated by
running:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_salatch_pmos_layout_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><img alt="salatch" src="../_images/tisaradc_salatch.png" /></p>
<ul class="simple">
<li>Here are additional scripts regarding the strongArm latch:<ol>
<li><strong>adc_sar_salatch_pmos_schematic_generator.py</strong>: schematic
generation</li>
<li><strong>adc_sar_salatch_pmos_schematic_lvs.py</strong>: LVS</li>
<li><strong>adc_sar_salatch_pmos_schematic_extract.py</strong>: RC extraction</li>
<li><strong>adc_sar_salatch_pmos_verify.py</strong>: verifications (clk-q,
noise)</li>
</ol>
</li>
</ul>
</li>
<li><p class="first">The next step is generating capacitor drivers that drive CDAC. Run
the following scripts:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_capdrv_nsw_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_capdrv_nsw_array_layout_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This is a 2-step generation; in the first script, individual driver
cells are generated. The second script places driver cells (with
the sizing parameters defined by <strong>capdrv_m_list</strong> in
<strong>adc_sar_size.yaml</strong>.</p>
<p>Here&#8217;s one example layout of the capdrv.</p>
<p><img alt="capdrv" src="../_images/tisaradc_capdrv.png" /></p>
<p>Here&#8217;s the capdrv_array layout (primitive cells are hidden).</p>
<p><img alt="capdrv" src="../_images/tisaradc_capdrv_array.png" /></p>
</li>
<li><p class="first">Now it&#8217;s time to generate the frontend top layout/schematic. Type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarafe_nsw_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarafe_nsw_schematic_generator</span><span class="o">.</span><span class="n">py</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarafe_nsw_lvs</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The commands will create a layout (and schematic) of <strong>sarafe_nsw</strong>,
which is the frontend top of subADC, and run LVS. Try different
presets introduced before and see if designs are generated properly.</p>
<p><img alt="sarafe" src="../_images/tisaradc_sarafe.png" /></p>
</li>
</ol>
</div>
<div class="section" id="subadc-backend-layout-generation">
<span id="subadc-backend-layout-generation"></span><h2>SubADC backend layout generation<a class="headerlink" href="#subadc-backend-layout-generation" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p class="first">The backend of subADCs is composed of FSM(sarfsm), SAR logic(sarlogic),
clock generator(sarclkgen), and retimer(sarret).</p>
<p>Run following scripts to generate those building blocks.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#FSM layout</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarfsm_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR logic</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarlogic_wret_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarlogic_wret_array_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR clock generator</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarclkdelay_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarclkgen_core_static2_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarclkgen_static_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR retimer</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarret_wckbuf_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#spacing elements for routing/filling</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_space_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR backend generation</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarabe_dualdelay_layout_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>SAR FSM</p>
<p><img alt="sarfsm" src="../_images/tisaradc_sarfsm.png" /></p>
<p>SAR logic</p>
<p><img alt="sarlogic" src="../_images/tisaradc_sarlogic.png" /></p>
<p>SAR logic array</p>
<p><img alt="sarlogic_array" src="../_images/tisaradc_sarlogic_array.png" /></p>
<p>SAR clock delayline</p>
<p><img alt="sarlogic_array" src="../_images/tisaradc_sarclkdelay.png" /></p>
<p>SAR clock generator</p>
<p><img alt="sarclkgen" src="../_images/tisaradc_sarclkgen.png" /></p>
<p>SAR retimer</p>
<p><img alt="sarret" src="../_images/tisaradc_sarret.png" /></p>
<p>SAR backend top</p>
<p><img alt="sarabe" src="../_images/tisaradc_sarabe.png" /></p>
</li>
</ol>
<ol>
<li><p class="first">For schematic generation, run scripts. Again, BAG is generating
schematics in hierarachical order, so you don&#8217;t need to run these
scripts if you want to generate in top level.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#FSM layout</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarfsm_schematic_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR logic</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarlogic_wret_array_schematic_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR clock generator</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarclkgen_static_schematic_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR retimer</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarret_wckbuf_schematic_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#spacing elements for routing/filling</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_space_schematic_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1">#SAR backend generation</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarabe_dualdelay_schematic_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</li>
<li><p class="first">The frontend and backend can be integrated by running following
scripts.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># layout</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sar_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># schematic</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sar_schematic_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><img alt="sar" src="../_images/tisaradc_sar.png" /></p>
</li>
</ol>
</div>
<div class="section" id="subadc-switch-generation">
<span id="subadc-switch-generation"></span><h2>SubADC switch generation<a class="headerlink" href="#subadc-switch-generation" title="Permalink to this headline">¶</a></h2>
<p>The sampling frontend can be generated either from laygo or AnalogBase.
While the sampler generated from AnalogBase (written by Eric Chang) is
more flexible, associated APIs need to be set up (which is not for the
cds_ff_mpt technology), so laygo based sampler is used for this example.</p>
<p>Run the following script to generate the sampling switches.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># layout</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarsamp_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># schematic</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sarsamp_schematic_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><img alt="sar" src="../_images/tisaradc_sarsamp.png" /></p>
<p>If the AnalogBase is set up for your technology, these scripts will
generate the sampling switches.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># layout</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">sampler_nmos_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># schematic</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">sampler_nmos_schematic_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
</div>
<div class="section" id="subadc-top-generation">
<span id="subadc-top-generation"></span><h2>SubADC top generation<a class="headerlink" href="#subadc-top-generation" title="Permalink to this headline">¶</a></h2>
<p>If all subblocks are generated sucessfully, the SubADC top (sar_wsamp)
can be easily generated by placing and routing subcells. Run the following
scripts to generate the SubADC top.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># layout</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sar_wsamp_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># schematic</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sar_wsamp_schematic_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>The generated layouts shown below are from the full-stack subADC
generation with different settings (9b, 6b, 10bits and different
sizing parameters).</p>
<p><img alt="sar" src="../_images/tisaradc_sar_wsamp.png" /></p>
</div>
<div class="section" id="array-generation">
<span id="array-generation"></span><h2>Array generation<a class="headerlink" href="#array-generation" title="Permalink to this headline">¶</a></h2>
<p>The SAR array can be easily made from running the following scripts.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># layout</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sar_wsamp_array_layout_generator</span><span class="o">.</span><span class="n">py</span>
<span class="c1"># schematic</span>
<span class="n">run</span> <span class="n">laygo</span><span class="o">/</span><span class="n">generators</span><span class="o">/</span><span class="n">adc_sar</span><span class="o">/</span><span class="n">adc_sar_sar_wsamp_array_schematic_generator</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p><img alt="sar" src="../_images/tisaradc_sar_wsamp_array.png" /></p>
</div>
<div class="section" id="clocking-path-generation">
<span id="clocking-path-generation"></span><h2>Clocking path generation<a class="headerlink" href="#clocking-path-generation" title="Permalink to this headline">¶</a></h2>
<p>Zhongkai Wang made schematic and layout generators for the clock
generation. Running following scripts will generate the clocking
frontend. (You don&#8217;t need this for non-interleaving ADCs)</p>
</div>
<div class="section" id="retimer">
<span id="retimer"></span><h2>Retimer<a class="headerlink" href="#retimer" title="Permalink to this headline">¶</a></h2>
<p>From now on, AnalogBase has to be set up for layout generations (which
is not for the cds_ff_mpt technology).</p>
</div>
<div class="section" id="bias">
<span id="bias"></span><h2>Bias<a class="headerlink" href="#bias" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="top">
<span id="top"></span><h2>Top<a class="headerlink" href="#top" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="full-stack-generation">
<span id="full-stack-generation"></span><h2>Full stack generation<a class="headerlink" href="#full-stack-generation" title="Permalink to this headline">¶</a></h2>
<p>in laygo/generators/adc_sar, there are various levels of full-stack
generators (generating all up to the specified hierarchy). Their filenames
end with <strong>fullstack_generator.py</strong></p>
</div>
<div class="section" id="contributors">
<span id="contributors"></span><h2>Contributors<a class="headerlink" href="#contributors" title="Permalink to this headline">¶</a></h2>
<p>The generator codes are written by Jaeduk Han, Eric Chang, Zhongkai Wang,
Woorham Bae, and Pengpeng Lu. This document is written by Jaeduk Han.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="code.html" class="btn btn-neutral float-right" title="Example codes">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ser_des.html" class="btn btn-neutral" title="CMOS SER/DES generator"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Jaeduk Han.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>